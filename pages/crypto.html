<!DOCTYPE html>
<html>
  <head>
    <title>Encryption and Decryption</title>
  </head>
  <body>
    <h2>Encryption and Decryption Tool</h2>

    <div>
      <label for="inputText">Enter Text:</label>
      <input type="text" id="inputText" placeholder="Text to encrypt/decrypt" />
    </div>

    <div>
      <input type="checkbox" id="useSecretKey" />
      <label for="useSecretKey">Use Secret Key:</label>
      <input type="text" id="secretKey" placeholder="Secret Key" disabled />
    </div>

    <div>
      <button id="encryptButton">Encrypt</button>
      <button id="decryptButton">Decrypt</button>
    </div>

    <div>
      <label>Result:</label>
      <div id="output"></div>
    </div>

    <script>
      const inputText = document.getElementById("inputText");
      const useSecretKeyCheckbox = document.getElementById("useSecretKey");
      const secretKeyInput = document.getElementById("secretKey");
      const encryptButton = document.getElementById("encryptButton");
      const decryptButton = document.getElementById("decryptButton");
      const outputDiv = document.getElementById("output");

      const DEFAULT_SECRET_KEY = "wilfredskey"; // Default secret key

      // Function to encrypt data
      async function encrypt(text, secretKey) {
        const encodedText = new TextEncoder().encode(text);
        const key = await crypto.subtle.importKey(
          "raw",
          new TextEncoder().encode(secretKey),
          "AES-CBC",
          false,
          ["encrypt"]
        );
        const encryptedData = await crypto.subtle.encrypt(
          { name: "AES-CBC" },
          key,
          encodedText
        );
        return btoa(
          String.fromCharCode.apply(null, new Uint8Array(encryptedData))
        );
      }

      // Function to decrypt data
      async function decrypt(encryptedText, secretKey) {
        const encryptedBytes = new Uint8Array(
          atob(encryptedText)
            .split("")
            .map((char) => char.charCodeAt(0))
        );
        const key = await crypto.subtle.importKey(
          "raw",
          new TextEncoder().encode(secretKey),
          "AES-CBC",
          false,
          ["decrypt"]
        );
        const decryptedData = await crypto.subtle.decrypt(
          { name: "AES-CBC" },
          key,
          encryptedBytes
        );
        return new TextDecoder().decode(decryptedData);
      }

      // Encrypt button click event
      encryptButton.addEventListener("click", async () => {
        const text = inputText.value;
        const useSecretKey = useSecretKeyCheckbox.checked;
        const secretKey = useSecretKey
          ? secretKeyInput.value || DEFAULT_SECRET_KEY
          : DEFAULT_SECRET_KEY;

        if (text) {
          try {
            const encryptedText = await encrypt(text, secretKey);
            outputDiv.textContent = "Encrypted: " + encryptedText;
          } catch (error) {
            outputDiv.textContent = "Encryption error: " + error;
          }
        } else {
          outputDiv.textContent = "Please enter text.";
        }
      });

      // Decrypt button click event
      decryptButton.addEventListener("click", async () => {
        const encryptedText = inputText.value;
        const useSecretKey = useSecretKeyCheckbox.checked;
        const secretKey = useSecretKey
          ? secretKeyInput.value || DEFAULT_SECRET_KEY
          : DEFAULT_SECRET_KEY;

        if (encryptedText) {
          try {
            const decryptedText = await decrypt(encryptedText, secretKey);
            outputDiv.textContent = "Decrypted: " + decryptedText;
          } catch (error) {
            outputDiv.textContent = "Decryption error: " + error;
          }
        } else {
          outputDiv.textContent = "Please enter encrypted text.";
        }
      });

      // Toggle the visibility of the secret key input
      useSecretKeyCheckbox.addEventListener("change", () => {
        secretKeyInput.disabled = !useSecretKeyCheckbox.checked;
      });
    </script>
  </body>
</html>
