<!DOCTYPE html>
<html>
  <head>
    <title>Encryption and Decryption</title>
  </head>
  <body>
    <h2>Encryption and Decryption Tool</h2>

    <div>
      <label for="inputText">Enter Text:</label>
      <input type="text" id="inputText" placeholder="Text to encrypt/decrypt" />
    </div>

    <div>
      <input type="checkbox" id="useSecretKey" />
      <label for="useSecretKey">Use Secret Key:</label>
      <input type="text" id="secretKey" placeholder="Secret Key" disabled />
    </div>

    <div>
      <button id="encryptButton">Encrypt</button>
      <button id="decryptButton">Decrypt</button>
    </div>

    <div>
      <label>Result:</label>
      <div id="output"></div>
    </div>

    <script>
      const inputText = document.getElementById("inputText");
      const useSecretKeyCheckbox = document.getElementById("useSecretKey");
      const secretKeyInput = document.getElementById("secretKey");
      const encryptButton = document.getElementById("encryptButton");
      const decryptButton = document.getElementById("decryptButton");
      const outputDiv = document.getElementById("output");

      // Generate a 128-bit secret key
      async function generateSecretKey() {
        return crypto.subtle.generateKey(
          { name: "AES-CBC", length: 128 },
          true,
          ["encrypt", "decrypt"]
        );
      }

      // Encrypt data with the secret key
      async function encrypt(text, key) {
        const iv = crypto.getRandomValues(new Uint8Array(16));
        const encodedText = new TextEncoder().encode(text);
        const encryptedData = await crypto.subtle.encrypt(
          { name: "AES-CBC", iv },
          key,
          encodedText
        );
        return btoa(
          String.fromCharCode.apply(null, new Uint8Array(encryptedData))
        );
      }

      // Decrypt data with the secret key
      async function decrypt(encryptedText, key) {
        const iv = crypto.getRandomValues(new Uint8Array(16));
        const encryptedBytes = new Uint8Array(
          atob(encryptedText)
            .split("")
            .map((char) => char.charCodeAt(0))
        );
        const decryptedData = await crypto.subtle.decrypt(
          { name: "AES-CBC", iv },
          key,
          encryptedBytes
        );
        return new TextDecoder().decode(decryptedData);
      }

      // Encrypt button click event
      encryptButton.addEventListener("click", async () => {
        const text = inputText.value;
        const useSecretKey = useSecretKeyCheckbox.checked;
        const secretKey = useSecretKey ? secretKeyInput.value : null;

        if (text && (!useSecretKey || secretKey)) {
          const key = useSecretKey
            ? await crypto.subtle.importKey(
                "raw",
                new TextEncoder().encode(secretKey),
                "AES-CBC",
                false,
                ["encrypt", "decrypt"]
              )
            : await generateSecretKey();
          const encryptedText = await encrypt(text, key);
          outputDiv.textContent = "Encrypted: " + encryptedText;
        } else {
          outputDiv.textContent =
            "Please enter text and, if required, a valid 128-bit secret key.";
        }
      });

      // Decrypt button click event
      decryptButton.addEventListener("click", async () => {
        const encryptedText = inputText.value;
        const useSecretKey = useSecretKeyCheckbox.checked;
        const secretKey = useSecretKey ? secretKeyInput.value : null;

        if (encryptedText && (!useSecretKey || secretKey)) {
          const key = useSecretKey
            ? await crypto.subtle.importKey(
                "raw",
                new TextEncoder().encode(secretKey),
                "AES-CBC",
                false,
                ["encrypt", "decrypt"]
              )
            : await generateSecretKey();
          const decryptedText = await decrypt(encryptedText, key);
          outputDiv.textContent = "Decrypted: " + decryptedText;
        } else {
          outputDiv.textContent =
            "Please enter encrypted text and, if required, a valid 128-bit secret key.";
        }
      });

      // Toggle the secret key input based on the checkbox
      useSecretKeyCheckbox.addEventListener("change", () => {
        secretKeyInput.disabled = !useSecretKeyCheckbox.checked;
      });
    </script>
  </body>
</html>
